<!DOCTYPE html>
<html>

<head>
  <title>Riwayat dan Peta</title>
  <style>
    body {
      background-color: #01FCFCFE;
      
    }

    #riwayat-table {
      margin-top: 20px;
      border-collapse: collapse;
      width: 100%;
      font-size: 100%;
    }

    #riwayat-table th,
    #riwayat-table td {
      padding: 8px;
      border: 1px solid #ccc;
    }

    #map {
      display: none;
      height: 400px;
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <!-- <h1>Riwayat dan Peta</h1> -->
  <table id="riwayat-table">
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Latitude</th>
        <th>Longitude</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="riwayat-body"></tbody>
  </table>

  <div id="map"></div>

  <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-database.js"></script>
  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyBWMpnteXJ02-866GqeC-3PZ-tc4ismiQM",
      authDomain: "gps-tracking-a6720.firebaseapp.com",
      databaseURL: "https://gps-tracking-a6720-default-rtdb.firebaseio.com",
      projectId: "gps-tracking-a6720",
      storageBucket: "gps-tracking-a6720.appspot.com",
      messagingSenderId: "1022620312323",
      appId: "1:1022620312323:web:121b87000efd09e7687f36"
    };
    firebase.initializeApp(firebaseConfig);

    var database = firebase.database();
    var coordinatesRef = database.ref("Riwayat");

    coordinatesRef.once("value", function (snapshot) {
      var riwayat = snapshot.val();

      if (riwayat) {
        renderRiwayat(riwayat);
      }
    });

    function renderRiwayat(riwayat) {
      var riwayatBody = document.getElementById("riwayat-body");

      Object.keys(riwayat).forEach(function (key) {
        var riwayatRow = document.createElement("tr");

        var tglCell = document.createElement("td");
        tglCell.textContent = riwayat[key].tgl;

        var latitudeCell = document.createElement("td");
        latitudeCell.textContent = riwayat[key].f_latitude;

        var longitudeCell = document.createElement("td");
        longitudeCell.textContent = riwayat[key].f_longitude;

        var petaCell = document.createElement("td");
        var petaButton = document.createElement("button");
        petaButton.textContent = "Tampilkan Peta";
        petaButton.addEventListener("click", function () {
          var latitude = riwayat[key].f_latitude;
          var longitude = riwayat[key].f_longitude;
          showMap(latitude, longitude);
        });
        petaCell.appendChild(petaButton);

        riwayatRow.appendChild(tglCell);
        riwayatRow.appendChild(latitudeCell);
        riwayatRow.appendChild(longitudeCell);
        riwayatRow.appendChild(petaCell);

        riwayatBody.appendChild(riwayatRow);
      });
    }

    function showMap(latitude, longitude) {
      var url = "https://www.google.com/maps/search/?api=1&query=" + latitude + "," + longitude;
      window.open(url, "_blank");
    }
  </script>
  <!-- <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script> -->
</body>

</html>